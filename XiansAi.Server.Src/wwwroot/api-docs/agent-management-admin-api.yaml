openapi: 3.0.3
info:
  title: Agent Management API (Admin)
  description: |
    **Admin APIs** for managing agents, their definitions, ownership, and tokens.
    
    These APIs are designed for **administrators** to manage agents across tenants. The Agent Management APIs support **agent templates** (system-scoped reusable agent definitions) that can be deployed as **agent instances** (tenant-scoped deployed agents). Agent templates can be organized by categories (Marketing, Sales, Service) and deployed to tenants. Once deployed as agent instances, they can be managed, configured, and assigned to reporting users. A marketplace is one example use case where agent templates can be browsed and deployed.
    
    **Important Notes:**
    - All endpoints are under `/api/admin/` prefix
    - Agent ID format: `{tenantName}@{agentName}` (e.g., `acme@support-agent`)
    - When an agent is added to a tenant, the user who performs the deployment automatically becomes the **admin** of that agent instance
    - Users are identified by user identifiers (userId, email, username, etc. - system dependent)
    - The `adminId` field is automatically set to the user identifier of the authenticated user who creates the agent
    - Requires admin authentication (SysAdmin or TenantAdmin)
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

servers:
  - url: https://api.example.com
    description: Production server
  - url: https://staging-api.example.com
    description: Staging server
  - url: http://localhost:5000
    description: Local development server

tags:
  - name: Agent CRUD
    description: Agent creation, reading, updating, and deletion operations
  - name: Agent Reporting Users
    description: Management of reporting users for agents
  - name: Agent Definitions
    description: Agent definition and configuration management
  - name: Agent Ownership
    description: Agent ownership and administration management
  - name: Agent Tokens
    description: Agent token management for external integrations
  - name: Agent Templates
    description: Browse and discover agent templates (system-scoped reusable agent definitions)

paths:
  /admin/tenants/{tenantId}/agents:
    post:
      tags:
        - Agent CRUD
      summary: Create Agent / Deploy Agent Template
      description: |
        Create a new agent instance in a tenant or deploy an agent template as an agent instance. 
        The authenticated user who creates/deploys the agent automatically becomes the **admin** of the agent instance.
      operationId: createAgent
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - name: fromTemplate
          in: query
          description: If true, deploy from agent template using templateId
          required: false
          schema:
            type: boolean
            default: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAgentRequest'
      responses:
        '201':
          description: Agent created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: Agent already exists in tenant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

    get:
      tags:
        - Agent CRUD
      summary: List Agents
      description: List all agents for a tenant
      operationId: listAgents
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: pageSize
          in: query
          description: Page size
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: List of agents
          content:
            application/json:
              schema:
                type: object
                properties:
                  agents:
                    type: array
                    items:
                      $ref: '#/components/schemas/AgentResponse'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

  /admin/tenants/{tenantId}/agents/{agentId}:
    get:
      tags:
        - Agent CRUD
      summary: Get Agent
      description: "Get agent details by ID. Agent ID format: {tenantName}@{agentName}"
      operationId: getAgent
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/AgentId'
      responses:
        '200':
          description: Agent details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

    put:
      tags:
        - Agent CRUD
      summary: Update Agent
      description: "Update agent configuration. Agent ID format: {tenantName}@{agentName}"
      operationId: updateAgent
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/AgentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAgentRequest'
      responses:
        '200':
          description: Agent updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

    delete:
      tags:
        - Agent CRUD
      summary: Delete Agent
      description: "Delete an agent. Agent ID format: {tenantName}@{agentName}"
      operationId: deleteAgent
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/AgentId'
      responses:
        '200':
          description: Agent deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Agent deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

  /api/admin/tenants/{tenantId}/agents/{agentId}/reporting-users:
    get:
      tags:
        - Agent Reporting Users
      summary: Get Reporting Targets
      description: Get list of reporting targets (users, groups, etc.) for an agent
      operationId: getReportingTargets
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/AgentId'
      responses:
        '200':
          description: List of reporting targets
          content:
            application/json:
              schema:
                type: object
                properties:
                  agentId:
                    type: string
                    example: acme@support-agent
                  reportingTargets:
                    type: array
                    items:
                      $ref: '#/components/schemas/ReportingTo'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

    post:
      tags:
        - Agent Reporting Users
      summary: Add Reporting Target
      description: Add a reporting target (user, group, etc.) to an agent. Both keys and values in attributes are strings.
      operationId: addReportingTarget
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/AgentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddReportingTargetRequest'
      responses:
        '201':
          description: Reporting target added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Reporting target added successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

  /api/admin/tenants/{tenantId}/agents/{agentId}/reporting-users/{targetId}:
    delete:
      tags:
        - Agent Reporting Users
      summary: Remove Reporting Target
      description: Remove a reporting target from an agent by target ID
      operationId: removeReportingTarget
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/AgentId'
        - name: targetId
          in: path
          required: true
          description: Reporting target identifier (userId, groupId, email, etc.)
          schema:
            type: string
            example: user123
      responses:
        '200':
          description: Reporting target removed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Reporting target removed successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

  /admin/tenants/{tenantId}/agents/{agentId}/definition:
    post:
      tags:
        - Agent Definitions
      summary: Upload Definition/Config
      description: Upload or update agent definition/configuration
      operationId: uploadDefinition
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/AgentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UploadDefinitionRequest'
      responses:
        '200':
          description: Definition uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Definition uploaded successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

  /admin/tenants/{tenantId}/agents/{agentId}/ownership:
    get:
      tags:
        - Agent Ownership
      summary: View Ownership
      description: |
        Get ownership and administration information for an agent. 
        Agent ID format: `{tenantName}@{agentName}`.
        
        The `adminId` is the user identifier of the user who originally deployed/created the agent. 
        Only the admin can transfer ownership or modify critical agent settings.
      operationId: getOwnership
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/AgentId'
      responses:
        '200':
          description: Ownership information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OwnershipResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

    put:
      tags:
        - Agent Ownership
      summary: Update Ownership / Transfer Admin
      description: |
        Transfer agent administration to another user (by user identifier). Only the current admin can perform this operation. 
        Agent ID format: `{tenantName}@{agentName}`.
      operationId: transferOwnership
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/AgentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TransferOwnershipRequest'
      responses:
        '200':
          description: Ownership transferred successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TransferOwnershipResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

  /admin/tenants/{tenantId}/agents/{agentId}/tokens:
    post:
      tags:
        - Agent Tokens
      summary: Issue Agent Token
      description: |
        Issue a new token for external parties to authenticate when calling the agent (e.g., for webhook endpoints). 
        Only the agent admin can create tokens.
        
        **Note**: The token value is only returned once upon creation. Store it securely as it cannot be retrieved later. 
        Use the token in the `Authorization` header as `Bearer {token}` or as a query parameter `?apikey={token}` when calling agent endpoints.
      operationId: issueToken
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/AgentId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IssueTokenRequest'
      responses:
        '201':
          description: Token created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

    get:
      tags:
        - Agent Tokens
      summary: List Tokens
      description: |
        List all tokens for an agent. Only the agent admin can view tokens. 
        Agent ID format: `{tenantName}@{agentName}`.
        
        **Note**: Token values are never returned in list responses for security reasons. Only metadata is provided.
      operationId: listTokens
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/AgentId'
        - name: active
          in: query
          description: Filter by active status
          required: false
          schema:
            type: boolean
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: pageSize
          in: query
          description: Page size
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
      responses:
        '200':
          description: List of tokens
          content:
            application/json:
              schema:
                type: object
                properties:
                  tokens:
                    type: array
                    items:
                      $ref: '#/components/schemas/TokenMetadata'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

  /admin/tenants/{tenantId}/agents/{agentId}/tokens/{tokenId}:
    get:
      tags:
        - Agent Tokens
      summary: Get Token Details
      description: |
        Get details about a specific token (without the token value). 
        Only the agent admin can view token details.
      operationId: getTokenDetails
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/AgentId'
        - name: tokenId
          in: path
          required: true
          description: Token ID
          schema:
            type: string
            example: token-12345
      responses:
        '200':
          description: Token details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenMetadata'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

    delete:
      tags:
        - Agent Tokens
      summary: Revoke Token
      description: |
        Revoke an agent token, immediately invalidating it. Only the agent admin can revoke tokens. 
        Agent ID format: `{tenantName}@{agentName}`.
      operationId: revokeToken
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - $ref: '#/components/parameters/AgentId'
        - name: tokenId
          in: path
          required: true
          description: Token ID
          schema:
            type: string
            example: token-12345
      responses:
        '200':
          description: Token revoked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  tokenId:
                    type: string
                  status:
                    type: string
                    enum: [revoked]
                  revokedAt:
                    type: string
                    format: date-time
                  revokedBy:
                    type: string
                    description: User identifier who revoked the token
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

  /api/admin/agentTemplates:
    get:
      tags:
        - Agent Templates
      summary: Browse Agent Templates (System Admin)
      description: |
        Browse all available agent templates (system-scoped reusable agent definitions).
        **System admin only. No X-Tenant-Id header required.**
      operationId: browseAgentTemplates
      parameters:
        - name: basicDataOnly
          in: query
          description: If true, return only basic template data without full details
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: List of agent templates
          content:
            application/json:
              schema:
                type: object
                properties:
                  agents:
                    type: array
                    items:
                      $ref: '#/components/schemas/AgentTemplate'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

  /api/admin/tenants/{tenantId}/agentTemplates:
    get:
      tags:
        - Agent Templates
      summary: Browse Agent Templates for Tenant
      description: |
        Browse agent templates eligible for a specific tenant.
        **X-Tenant-Id header required.**
        Future: Eligibility filtering will be implemented.
      operationId: browseAgentTemplatesForTenant
      parameters:
        - $ref: '#/components/parameters/TenantId'
        - name: basicDataOnly
          in: query
          description: If true, return only basic template data without full details
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: List of agent templates eligible for the tenant
          content:
            application/json:
              schema:
                type: object
                properties:
                  agents:
                    type: array
                    items:
                      $ref: '#/components/schemas/AgentTemplate'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

  /api/admin/agentTemplate/{templateObjectId}:
    get:
      tags:
        - Agent Templates
      summary: Get Agent Template Details (System Admin)
      description: |
        Get detailed information about an agent template by MongoDB ObjectId, including sample prompts and metadata.
        **System admin only. No X-Tenant-Id header required.**
      operationId: getAgentTemplateDetails
      parameters:
        - name: templateObjectId
          in: path
          required: true
          description: Agent template MongoDB ObjectId
          schema:
            type: string
            example: 69596ca63f39925d6e26b216
        - name: basicDataOnly
          in: query
          description: If true, return only basic template data without full details
          required: false
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Agent template details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentTemplateDetails'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

    put:
      tags:
        - Agent Templates
      summary: Update Agent Template Metadata (System Admin)
      description: |
        Update metadata of an agent template (category, description, icon, samplePrompts).
        Category supports multiple values as comma-separated string (e.g., "customer-support,beta").
        **System admin only. No X-Tenant-Id header required.**
      operationId: updateAgentTemplateMetadata
      parameters:
        - name: templateObjectId
          in: path
          required: true
          description: Agent template MongoDB ObjectId
          schema:
            type: string
            example: 69596ca63f39925d6e26b216
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAgentTemplateRequest'
      responses:
        '200':
          description: Agent template updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentTemplate'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

    delete:
      tags:
        - Agent Templates
      summary: Delete Agent Template (System Admin)
      description: |
        Delete an agent template by MongoDB ObjectId.
        **System admin only. No X-Tenant-Id header required.**
      operationId: deleteAgentTemplate
      parameters:
        - name: templateObjectId
          in: path
          required: true
          description: Agent template MongoDB ObjectId
          schema:
            type: string
            example: 69596ca63f39925d6e26b216
      responses:
        '200':
          description: Agent template deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Agent template deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

  /api/admin/agentTemplate/{templateObjectId}/Metadata:
    put:
      tags:
        - Agent Templates
      summary: Update Agent Template Metadata (System Admin)
      description: |
        Update metadata of an agent template (category, description, icon, samplePrompts).
        Category supports multiple values as comma-separated string (e.g., "customer-support,beta").
        This is an alias for PUT /api/admin/agentTemplate/{templateObjectId}.
        **System admin only. No X-Tenant-Id header required.**
      operationId: updateAgentTemplateMetadataExplicit
      parameters:
        - name: templateObjectId
          in: path
          required: true
          description: Agent template MongoDB ObjectId
          schema:
            type: string
            example: 69596ca63f39925d6e26b216
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAgentTemplateRequest'
      responses:
        '200':
          description: Agent template updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentTemplate'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

  /api/admin/agentTemplate/{templateObjectId}/deploy:
    post:
      tags:
        - Agent Templates
      summary: Deploy Agent Template to Tenant
      description: |
        Deploy an agent template to a specific tenant, creating a new agent instance.
        **X-Tenant-Id header required.**
        Future: Eligibility validation will be implemented.
      operationId: deployAgentTemplate
      parameters:
        - name: templateObjectId
          in: path
          required: true
          description: Agent template MongoDB ObjectId
          schema:
            type: string
            example: 69596ca63f39925d6e26b216
        - name: tenantId
          in: query
          required: true
          description: Tenant ID to deploy the agent to
          schema:
            type: string
            example: acme-corp
      responses:
        '201':
          description: Agent deployed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AgentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []
        - apiKey: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from authentication endpoint
    apiKey:
      type: apiKey
      in: header
      name: X-API-Key
      description: API key for authentication

  parameters:
    TenantId:
      name: tenantId
      in: path
      required: true
      description: Tenant ID
      schema:
        type: string
        example: acme-corp
    AgentId:
      name: agentId
      in: path
      required: true
      description: Agent ID in format `{tenantName}@{agentName}`
      schema:
        type: string
        pattern: '^[^@]+@[^@]+$'
        example: acme@support-agent

  schemas:
    CreateAgentRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Agent name
          example: support-agent
        description:
          type: string
          description: Agent description
          example: Customer support agent for handling inquiries
        category:
          type: string
          enum: [marketing, sales, service]
          description: Agent category
          example: service
        configuration:
          type: object
          description: Agent configuration
          additionalProperties: true
        reportingTargets:
          type: array
          items:
            $ref: '#/components/schemas/ReportingTo'
          description: List of reporting targets (users, groups, etc.) with flexible attributes
          example:
            - id: "user123"
              attributes:
                type: "user"
                email: "manager@example.com"
                name: "John Manager"
        templateId:
          type: string
          description: Agent template ID (required if fromTemplate=true)
          example: support-agent-v1

    UpdateAgentRequest:
      type: object
      properties:
        name:
          type: string
          description: Agent name
        description:
          type: string
          description: Agent description
        configuration:
          type: object
          description: Agent configuration
          additionalProperties: true
        reportingTargets:
          type: array
          items:
            $ref: '#/components/schemas/ReportingTo'
          description: List of reporting targets (users, groups, etc.) with flexible attributes

    AgentResponse:
      type: object
      properties:
        agentId:
          type: string
          description: Agent ID in format `{tenantName}@{agentName}`
          example: acme@support-agent
        name:
          type: string
          example: support-agent
        tenantId:
          type: string
          example: acme-corp
        agentTemplateId:
          type: string
          description: Reference to the agent template (if deployed from template)
          example: support-agent-v1
        adminId:
          type: string
          description: User identifier of the admin user (stored in metadata, automatically set to deploying user)
          example: admin@example.com
        reportingTargets:
          type: array
          items:
            $ref: '#/components/schemas/ReportingTo'
          description: List of reporting targets (stored in metadata)
          example:
            - id: "user123"
              attributes:
                type: "user"
                email: "manager@example.com"
              addedAt: "2024-01-15T10:30:00Z"
              addedBy: "admin@example.com"
        metadata:
          type: object
          description: Flexible metadata dictionary containing instance-specific data (adminId, reportingUsers, deployedAt, deployedById, configuration, etc.)
          additionalProperties: true
          example:
            adminId: admin@example.com
            reportingTargets:
              - id: "user123"
                attributes:
                  type: "user"
                  email: "manager@example.com"
            deployedAt: "2024-01-15T10:30:00Z"
            deployedById: admin@example.com
            configuration:
              customSetting: value
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        createdBy:
          type: string
          description: User identifier who created the agent
          example: admin@example.com

    ReportingTo:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          description: Reporting target identifier (userId, groupId, email, etc.)
          example: user123
        attributes:
          type: object
          description: Flexible attributes dictionary. Both keys and values are strings.
          additionalProperties:
            type: string
          example:
            type: "user"
            email: "manager@example.com"
            name: "John Manager"
            role: "team-lead"
        addedAt:
          type: string
          format: date-time
          description: Timestamp when this reporting target was added
          example: "2024-01-15T10:30:00Z"
        addedBy:
          type: string
          description: User identifier who added this reporting target
          example: admin@example.com

    AddReportingTargetRequest:
      type: object
      required:
        - id
      properties:
        id:
          type: string
          description: Reporting target identifier (userId, groupId, email, etc.)
          example: user123
        attributes:
          type: object
          description: Optional attributes dictionary. Both keys and values are strings.
          additionalProperties:
            type: string
          example:
            type: "user"
            email: "manager@example.com"
            name: "John Manager"

    UploadDefinitionRequest:
      type: object
      required:
        - definition
      properties:
        definition:
          type: object
          description: Agent definition/configuration
          additionalProperties: true
        version:
          type: string
          description: Definition version
          example: "1.0.0"

    OwnershipResponse:
      type: object
      properties:
        agentId:
          type: string
          example: acme@support-agent
        adminId:
          type: string
          description: User identifier of the admin
          example: admin@example.com
        tenantId:
          type: string
          example: acme-corp
        createdBy:
          type: string
          description: User identifier who created the agent
          example: admin@example.com
        deployedBy:
          type: string
          description: User identifier who deployed the agent
          example: admin@example.com
        deployedAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        permissions:
          type: object
          properties:
            admin:
              type: object
              properties:
                userId:
                  type: string
                  description: User identifier of the admin
                grantedAt:
                  type: string
                  format: date-time
            reportingTargets:
              type: array
              items:
                $ref: '#/components/schemas/ReportingTo'

    TransferOwnershipRequest:
      type: object
      required:
        - newAdminId
      properties:
        newAdminId:
          type: string
          description: User identifier of the new admin (userId, email, username, etc.)
          example: newadmin@example.com
        transferReason:
          type: string
          example: Transferring to new team lead

    TransferOwnershipResponse:
      type: object
      properties:
        agentId:
          type: string
          example: acme@support-agent
        previousAdminId:
          type: string
          description: User identifier of the previous admin
          example: oldadmin@example.com
        newAdminId:
          type: string
          description: User identifier of the new admin
          example: newadmin@example.com
        transferredAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        transferredBy:
          type: string
          description: User identifier who performed the transfer
          example: oldadmin@example.com

    IssueTokenRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          description: Human-readable name for the token
          example: Webhook Integration - CRM System
        description:
          type: string
          description: Description of the token's intended use
          example: Token for CRM webhook integration
        expiresIn:
          type: integer
          description: Expiration time in seconds (null for no expiration)
          nullable: true
          example: 86400
        permissions:
          type: array
          items:
            type: string
            enum: [invoke, read, write]
          description: Array of permissions
          default: [invoke]
          example: [invoke, read]
        allowedEndpoints:
          type: array
          items:
            type: string
            enum: [webhook, api, sse]
          description: Array of allowed endpoint types
          default: [webhook, api, sse]
          example: [webhook, api]

    TokenResponse:
      type: object
      properties:
        tokenId:
          type: string
          example: token-12345
        token:
          type: string
          description: Token value (only returned once upon creation)
          example: xai_agent_abc123xyz789
        name:
          type: string
          example: Webhook Integration - CRM System
        expiresAt:
          type: string
          format: date-time
          nullable: true
          example: "2024-02-15T10:30:00Z"
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        createdBy:
          type: string
          format: email
          example: admin@example.com
        permissions:
          type: array
          items:
            type: string
          example: [invoke, read]
        allowedEndpoints:
          type: array
          items:
            type: string
          example: [webhook, api]

    TokenMetadata:
      type: object
      properties:
        tokenId:
          type: string
          example: token-12345
        name:
          type: string
          example: Webhook Integration - CRM System
        description:
          type: string
          example: Token for CRM webhook integration
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        expiresAt:
          type: string
          format: date-time
          nullable: true
          example: "2024-02-15T10:30:00Z"
        lastUsed:
          type: string
          format: date-time
          nullable: true
          example: "2024-01-20T14:30:00Z"
        status:
          type: string
          enum: [active, expired, revoked]
          example: active
        permissions:
          type: array
          items:
            type: string
          example: [invoke, read]
        allowedEndpoints:
          type: array
          items:
            type: string
          example: [webhook, api]
        createdBy:
          type: string
          description: User identifier who created the token
          example: admin@example.com
        usageCount:
          type: integer
          example: 42

    AgentTemplate:
      type: object
      properties:
        templateId:
          type: string
          example: support-agent-v1
        name:
          type: string
          example: Support Agent
        category:
          type: string
          description: Category stored in metadata. Supports multiple categories as comma-separated string (e.g., "customer-support,beta")
          example: service
        description:
          type: string
          description: Description stored in metadata
          example: Customer support agent for handling inquiries
        icon:
          type: string
          description: Icon identifier or URL stored in metadata
          example: https://example.com/icons/support-agent.png
        samplePrompts:
          type: array
          items:
            $ref: '#/components/schemas/SamplePrompt'
          description: Sample prompts stored in metadata
        metadata:
          type: object
          description: Flexible metadata dictionary containing template-specific data (category, samplePrompts, description, icon, etc.)
          additionalProperties: true
          example:
            category: service
            description: Customer support agent for handling inquiries
            icon: https://example.com/icons/support-agent.png
            samplePrompts:
              - id: prompt-1
                title: Basic Customer Inquiry
                prompt: "Help a customer with their order status"
        isDeployed:
          type: boolean
          description: Whether this agent is already deployed in the current tenant
          example: false

    AgentTemplateDetails:
      allOf:
        - $ref: '#/components/schemas/AgentTemplate'
        - type: object
          properties:
            features:
              type: array
              items:
                type: string
              example: ["Ticket management", "Email integration", "Knowledge base"]
            requirements:
              type: array
              items:
                type: string
              example: ["Email access", "CRM integration"]
            samplePrompts:
              type: array
              items:
                $ref: '#/components/schemas/SamplePrompt'
            testScenarios:
              type: array
              items:
                $ref: '#/components/schemas/TestScenario'
            configurationExamples:
              type: array
              items:
                type: object
                additionalProperties: true

    SamplePrompt:
      type: object
      properties:
        id:
          type: string
          example: prompt-1
        title:
          type: string
          example: Basic Customer Inquiry
        prompt:
          type: string
          example: "Help a customer with their order status"
        description:
          type: string
          example: Test basic customer inquiry handling
        icon:
          type: string
          description: Icon identifier or URL for the prompt (can be embedded)
          example: document
        category:
          type: string
          enum: [basic, advanced, edge-case]
          example: basic

    TestScenario:
      type: object
      properties:
        id:
          type: string
          example: scenario-1
        name:
          type: string
          example: Order Status Inquiry
        description:
          type: string
          example: Test order status inquiry handling
        input:
          type: object
          additionalProperties: true
        expectedOutput:
          type: object
          additionalProperties: true

    Pagination:
      type: object
      properties:
        page:
          type: integer
          example: 1
        pageSize:
          type: integer
          example: 20
        totalPages:
          type: integer
          example: 5
        totalItems:
          type: integer
          example: 100
        hasNext:
          type: boolean
          example: true
        hasPrevious:
          type: boolean
          example: false

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          example: Error message
        message:
          type: string
          example: Detailed error message
        details:
          type: object
          additionalProperties: true

  responses:
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Forbidden - Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    InternalServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'

